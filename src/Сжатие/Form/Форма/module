	//РазрешеныСимволы = "1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnmёйцукенгшщзхъфывапролджэячсмитьбюЁЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮ-=\/.,)_+;%:?*!№`~@#$^&([]{}'<>|§♠╔╕╞╗╤╥╙╘╒╓╫╪┘┌·°ўЎїЇєЄ∙·√№¤■↕◘○◙♂♀♪♫☼►"; 

Процедура КнопкаВыполнитьНажатие(Кнопка)
	ЗамерВремя = ТекущаяДата();
	СтруктураПараметров = Вычислить("СжатьТекст(Распакован, СжатьИтераций, ИзСтроки)");
	Упакован = СтруктураПараметров.Текст;
	Разделители = СтруктураПараметров.Разделители;
	Сообщить(Строка(СтруктураПараметров.Итераций) + " итераций за "+ Строка(ТекущаяДата() - ЗамерВремя)+ " сек.");
	ПересчитатьРазмеры();
	МассивСжатий = СтруктураПараметров.МассивСжатий;
	Минимум = стрДлина(Упакован);
	ЛучшееСжатие = СтруктураПараметров.Итераций; 
	Сообщить("Лучшее сжатие при "+Строка(ЛучшееСжатие) + " итераций. размер "+ Строка(Минимум));
КонецПроцедуры

Процедура ОсновныеДействияФормыРаспаковать(Кнопка)
	Распакован = Вычислить("Распаковать(Упакован, Разделители)");
	ПересчитатьРазмеры();
КонецПроцедуры

Процедура РаспакованПриИзменении(Элемент)
	ПересчитатьРазмеры();
КонецПроцедуры

Процедура УпакованПриИзменении(Элемент)
	ПересчитатьРазмеры();
КонецПроцедуры
 
Процедура ПриОткрытии()
Т="ключХформЗяgtOЩ4е2VШедГтeНDиЕлиЙаемыйЁ Iдулъг6ммEёа79m Rдnзаbнеv6сcроxнаz мlисkимj дhвлgYеf7оdгоsреa 9pпоoзделfлi2 RBрыйu6ботyяGсtDь rакeанwUиqм M.
|NтоBовVныC вZльL сKходJ, HетGатDRЙчеQвAoлPя OмоIенqтf TкоRа EноWстQ f6ций0иpпаRв8 пр7ра6KжЕ4 обyк3 текQ2Позд6gяемHвыKкачал9сVершUW нUужную3у!
|ЦеLhwWй39эBШNПосRLкуZ 1С ниRгдEнTтaбVалосьKжjrkJCTRды иЙ2ыHB7jqIQьhwCхlGодVKомнfLzNОбyкEбылEzпkwEс цеLю «6змять Iзг»pдлO6зgечqяNПxёcпxQ6нtO«Кe еQь»Hникeих га6нтийpотвGQвUWQ9нToд6зумеваGNВозIжW PезCMoбочCMэффекBMyыhwWs7иложqOЩvчYаеIQь2V7и4иHWZ плDЗT1СpН7ГусIтaWШ kJCхnVHEН жTbщYmoIщ9крипBг6фииHпутеMуQаWвк9паxлOz2ыъей
|СжЕT(избаgqTот избыBчWQи)2mбоLшоMAе0dkJYhVоLWlГлUWpтaбуGlWsZaмqHт.кlWsк6тWdJY oKжjаеIму2уNВKаIMнижvMPе3EсоздаGu  IжWdQоZQавYьZnKвоеsъO9дwCй2 cпeуGся79kPнqиHН zзывЁ «СаIc8ывающийсOархив ил9SFX». КQЕuZыKейчас чYаGTН-жTb8wpх6нYсOвnTв b8wWмZидеHmbпуске39выPнtяdцГу6 c8киNИнQрукцияNДля4я2EvобJиIKRпирVrил9ввеQ9сжjЁ2ZZерхvTPTвводE«ИсJCй»HуказrмeсjаLWTAо0hля4O9zжrнEкWпку «У8Dь». Чеaз vRBxTвaмO(прибЙзfLW 5lинут)dёbPнY оQаLCTPOЗы39у8wCм2оM9«Раiи»NВ окнTсообщqй будGZывГUEQЕQика4я: зEсRLR0dизошло4еNСтxкE6iей oKут9ЩХоMдлOc8к9сжDоs2аHдЙнEэBs ХEвсегдE6внEAу зD6чUCх0.";
for а=1 to 68 do в=Mid("ХЗЩШГНЕЙЁъёmnbvcxzlkjhgfdsapoiuytrewqMNBVCZLKJHGDAPOIUYTREWQ09876432",а,1);б=find(Т,в);Т=StrReplace(Mid(Т,б+1),в,Лев(Т,б-1));enddo;
Распакован = Т;
СжатьИтераций = 100;
КонецПроцедуры

Процедура ПересчитатьРазмеры()
	УпакованоРазмер = Строка(СтрДлина(Упакован));
	SFX = ПолучитьТекстМиниСамораспаковки(Упакован,Разделители);
	
	РаспакованоРазмер = Строка(СтрДлина(Распакован));
	Попытка
		ЭлементыФормы.Процент.Заголовок = "Сжат на "+ 
		Формат(100 - ((СтрДлина(Упакован) + стрДлина(Разделители))/стрДлина(Распакован))*100,"ЧДЦ=0; ЧГ=0") + "%" + Символы.ПС + Символы.ВК +
		"SFX:"+Строка(СтрДлина(SFX));
	Исключение
	КонецПопытки;
КонецПроцедуры

Процедура ОсновныеДействияФормыСамараспаковкаВыполнить(Кнопка)
	t = "";
	Выполнить(SFX);
	Распакован = t;	
КонецПроцедуры
 //--------------------------------------------------------
Функция ПолучитьТекстМиниДляVBNET(знач Т,знач Р)  Экспорт
	Если СтрЧислоВхождений(Т,символы.ПС) > 0 Тогда
		СтруктураПараметров = ИнициализироватьСтруктуру(Т, ИзСтроки);
		СтруктураПараметров.Разделитель = Лев(НайтиНеиспользованныеСимволы(Т, ВРЕГ(СтруктураПараметров.РазрешеныСимволы)),1);	
		СтруктураПараметров.ОптимальноеСлово = Символы.ПС;
		СтруктураПараметров.Разделители = Р;
		УпаковатьСтроку(СтруктураПараметров);	
		Т = СтруктураПараметров.Текст;
		Р = СтруктураПараметров.Разделители;
	КонецЕсли;
	Исходник = "  dim t As String   
	|  dim b AS String
	|  dim c AS Integer
	|	t=УпакованТекст""
	|	for i AS Integer = 1 to КоличествоСимволов
	|		b=Mid(""Разделители"",i,1)
	|		c=InStr(t,b)
	|		t=Mid(t,c+1).Replace(b,Left(t,c-1))
	|	next
	|   Console.WriteLine(t)    ";
	Т = """" + СтрЗаменить(Т,"""","""""");
	Если СтрЧислоВхождений(Т,символы.ПС) > 0 Тогда	
		 Т = СтрЗаменить(Т,Символы.ВК,"");Т = "vbNewLine & "+СтрЗаменить(Т,Символы.ПС,"");
	КонецЕсли;
	Исходник = СтрЗаменить(Исходник ,"КоличествоСимволов",Строка(StrLen(Р)));
	Исходник = СтрЗаменить(Исходник ,"Разделители",Р);				
	Исходник = СтрЗаменить(Исходник ,"УпакованТекст",Т);				
	Возврат Исходник;
КонецФункции
//lua1
//t = "fty1 111"
//s = string;u = s.sub;for i = 1,1 do b=u("1",i,1);c=s.find(t,b);t=s.gsub(u(t,c+1),b,u(t,1,c-1)) end
//io.write(t)
//Упаковка2
Процедура ОсновныеДействияФормыСжатие2(Кнопка)
//t = "fty1 111"
//for i = 1,1 do b=string.sub("1",i,1) c=t:find(b) t=t:sub(c+1):gsub(b,t:sub(1,c-1)) end
//io.write(t)
	Упакован = СтрЗаменить(СтрЗаменить(ЗначениеВСтрокувнутр(Новый ХранилищеЗначения(Распакован, Новый СжатиеДанных(9))),Символы.ПС,Символы.ПС+"|"),"""","""""");
    ПересчитатьРазмеры();
	SFX = "Т=ЗначениеИзСтрокиВнутр("""+Упакован+""").Получить()";
КонецПроцедуры

Процедура ОсновныеДействияФормыУпаковатьВБА(Кнопка)
	ПересчитатьРазмеры();
	SFX = ПолучитьТекстМиниДляVBNET(Упакован,Разделители);
КонецПроцедуры
//----------------------------------------------
